<view class="search-page">
  <custom-nav title="æœç´¢" show-back="{{true}}" />

  <view class="search-container" style="padding-top: {{customNavHeight}}px">
    <!-- æœç´¢æ ‡ç­¾ -->
    <view class="search-tabs" wx:if="{{searchValue}}">
      <view class="tabs-container">
        <block wx:for="{{tabs}}" wx:key="id">
          <view 
            class="tab-item {{activeTab === item.id ? 'active' : ''}}"
            data-tab="{{item.id}}"
            bind:tap="onTabTap"
          >
            <text class="tab-name">{{item.name}}</text>
            <view class="tab-indicator"></view>
          </view>
        </block>
      </view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <view class="search-results" wx:if="{{searchValue}}">
      <!-- å¸–å­ç»“æœ -->
      <view class="results-section" wx:if="{{activeTab === 'post'}}">
        <block wx:for="{{searchResults}}" wx:key="_id">
          <post-card 
            postData="{{item}}"
            bind:like="onLikePost"
            bind:comment="onCommentPost"
            bind:avatarTap="onAvatarTap"
          />
        </block>
      </view>

      <!-- ç”¨æˆ·ç»“æœ -->
      <view class="results-section" wx:if="{{activeTab === 'user'}}">
        <block wx:for="{{searchResults}}" wx:key="_id">
          <view class="user-result-item" data-item="{{item}}" data-type="user" bind:tap="onResultTap">
            <image class="user-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" />
            <view class="user-info">
              <text class="user-name">{{item.nickName}}</text>
              <text class="user-desc">{{item.bio || 'è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡å†™'}}</text>
            </view>
            <view class="user-stats">
              <text class="stat-text">{{item.followersCount || 0}} ç²‰ä¸</text>
            </view>
          </view>
        </block>
      </view>

      <!-- æ ‡ç­¾ç»“æœ -->
      <view class="results-section" wx:if="{{activeTab === 'tag'}}">
        <block wx:for="{{searchResults}}" wx:key="_id">
          <view class="tag-result-item" data-item="{{item}}" data-type="tag" bind:tap="onResultTap">
            <view class="tag-icon">#</view>
            <view class="tag-info">
              <text class="tag-name">{{item.name}}</text>
              <text class="tag-count">{{item.postCount || 0}} ç¯‡å†…å®¹</text>
            </view>
            <view class="tag-hot" wx:if="{{item.isHot}}">
              <text class="hot-text">çƒ­é—¨</text>
            </view>
          </view>
        </block>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{searching}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">æœç´¢ä¸­...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:if="{{!hasMore && searchResults.length > 0}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šç»“æœäº†</text>
      </view>

      <!-- ç©ºç»“æœ -->
      <view class="empty-results" wx:if="{{!searching && searchResults.length === 0}}">
        <text class="empty-icon">ğŸ”</text>
        <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</text>
        <text class="empty-desc">æ¢ä¸ªå…³é”®è¯è¯•è¯•å§</text>
      </view>
    </view>

    <!-- æœç´¢å‰çŠ¶æ€ -->
    <view class="search-before" wx:if="{{!searchValue}}">
      <!-- æœç´¢å†å² -->
      <view class="history-section" wx:if="{{searchHistory.length > 0}}">
        <view class="section-header">
          <text class="section-title">æœç´¢å†å²</text>
          <view class="clear-history" bind:tap="onClearHistory">
            <text class="clear-text">æ¸…é™¤</text>
          </view>
        </view>
        <view class="history-tags">
          <block wx:for="{{searchHistory}}" wx:key="*this">
            <view 
              class="history-tag" 
              data-keyword="{{item}}"
              bind:tap="onHistoryTap"
            >
              <text class="history-text">{{item}}</text>
            </view>
          </block>
        </view>
      </view>

      <!-- çƒ­é—¨æœç´¢ -->
      <view class="hot-section">
        <view class="section-header">
          <text class="section-title">çƒ­é—¨æœç´¢</text>
        </view>
        <view class="hot-list">
          <block wx:for="{{hotSearches}}" wx:key="keyword">
            <view 
              class="hot-item" 
              data-keyword="{{item.keyword}}"
              bind:tap="onHotSearchTap"
            >
              <view class="hot-rank">{{index + 1}}</view>
              <text class="hot-keyword">{{item.keyword}}</text>
              <text class="hot-count">{{item.count}} æœç´¢</text>
            </view>
          </block>
        </view>
      </view>
    </view>
  </view>
</view>