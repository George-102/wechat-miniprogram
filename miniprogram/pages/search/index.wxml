<view class="search-page">
  <!-- 自定义导航栏 -->
  <view class="custom-nav" style="height: {{customNavHeight}}px">
    <view class="nav-content" style="height: 44px; padding-top: {{statusBarHeight}}px">
      <view class="nav-back" bind:tap="onNavigateBack">
        <text class="back-icon">‹</text>
      </view>
      <view class="search-input-container">
        <input 
          class="search-input" 
          placeholder="搜索帖子、用户、标签..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          focus="{{autoFocus}}"
        />
        <view class="search-icon" bind:tap="onSearchConfirm">🔍</view>
      </view>
      <view class="nav-actions">
        <view class="nav-btn" bind:tap="onCancelSearch">
          <text class="btn-text">取消</text>
        </view>
      </view>
    </view>
  </view>

  <view class="search-container" style="padding-top: {{customNavHeight}}px">
    <!-- 热门搜索 -->
    <view class="hot-search-section" wx:if="{{!searchResult && !searchKeyword}}">
      <view class="section-header">
        <text class="section-title">热门搜索</text>
      </view>
      <view class="hot-tags">
        <block wx:for="{{hotTags}}" wx:key="id">
          <view class="tag-item" data-tag="{{item.name}}" bind:tap="onHotTagTap">
            <text class="tag-text">{{item.name}}</text>
            <text class="tag-count">{{item.count}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- 搜索历史 -->
    <view class="search-history-section" wx:if="{{!searchResult && !searchKeyword}}">
      <view class="section-header">
        <text class="section-title">搜索历史</text>
        <view class="clear-history" bind:tap="onClearHistory">
          <text class="clear-text">清空</text>
        </view>
      </view>
      <view class="history-list">
        <block wx:for="{{searchHistory}}" wx:key="*this">
          <view class="history-item" data-keyword="{{item}}" bind:tap="onHistoryItemTap">
            <text class="history-text">{{item}}</text>
            <view class="delete-history" data-keyword="{{item}}" bind:tap="onDeleteHistoryItem">
              <text class="delete-icon">×</text>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- 搜索结果 -->
    <view class="search-result-section" wx:if="{{searchResult}}">
      <view class="result-tabs">
        <view 
          class="tab-item {{activeTab === 'realtime' ? 'active' : ''}}" 
          data-tab="realtime"
          bind:tap="onTabSwitch"
        >
          <text class="tab-name">实时</text>
        </view>
        <view 
          class="tab-item {{activeTab === 'history' ? 'active' : ''}}" 
          data-tab="history"
          bind:tap="onTabSwitch"
        >
          <text class="tab-name">历史</text>
        </view>
      </view>

      <view class="result-list">
        <block wx:for="{{searchResult.posts}}" wx:key="_id">
          <post-card 
            postData="{{item}}"
            bind:like="onLikePost"
            bind:comment="onCommentPost"
            bind:share="onSharePost"
            bind:avatarTap="onAvatarTap"
          />
        </block>
      </view>

      <!-- 加载状态 -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">搜索中...</text>
      </view>

      <!-- 没有结果 -->
      <view class="empty-result" wx:if="{{!loading && searchResult.posts.length === 0}}">
        <text class="empty-icon">🔍</text>
        <text class="empty-text">没有找到相关结果</text>
        <text class="empty-desc">换个关键词试试吧</text>
      </view>
    </view>
  </view>
</view>