<view class="search-page">
  <custom-nav title="搜索" show-back="{{true}}" />

  <view class="search-container" style="padding-top: {{customNavHeight}}px">
    <!-- 搜索标签 -->
    <view class="search-tabs" wx:if="{{searchValue}}">
      <view class="tabs-container">
        <block wx:for="{{tabs}}" wx:key="id">
          <view 
            class="tab-item {{activeTab === item.id ? 'active' : ''}}"
            data-tab="{{item.id}}"
            bind:tap="onTabTap"
          >
            <text class="tab-name">{{item.name}}</text>
            <view class="tab-indicator"></view>
          </view>
        </block>
      </view>
    </view>

    <!-- 搜索结果 -->
    <view class="search-results" wx:if="{{searchValue}}">
      <!-- 帖子结果 -->
      <view class="results-section" wx:if="{{activeTab === 'post'}}">
        <block wx:for="{{searchResults}}" wx:key="_id">
          <post-card 
            postData="{{item}}"
            bind:like="onLikePost"
            bind:comment="onCommentPost"
            bind:avatarTap="onAvatarTap"
          />
        </block>
      </view>

      <!-- 用户结果 -->
      <view class="results-section" wx:if="{{activeTab === 'user'}}">
        <block wx:for="{{searchResults}}" wx:key="_id">
          <view class="user-result-item" data-item="{{item}}" data-type="user" bind:tap="onResultTap">
            <image class="user-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" />
            <view class="user-info">
              <text class="user-name">{{item.nickName}}</text>
              <text class="user-desc">{{item.bio || '这个人很懒，什么都没写'}}</text>
            </view>
            <view class="user-stats">
              <text class="stat-text">{{item.followersCount || 0}} 粉丝</text>
            </view>
          </view>
        </block>
      </view>

      <!-- 标签结果 -->
      <view class="results-section" wx:if="{{activeTab === 'tag'}}">
        <block wx:for="{{searchResults}}" wx:key="_id">
          <view class="tag-result-item" data-item="{{item}}" data-type="tag" bind:tap="onResultTap">
            <view class="tag-icon">#</view>
            <view class="tag-info">
              <text class="tag-name">{{item.name}}</text>
              <text class="tag-count">{{item.postCount || 0}} 篇内容</text>
            </view>
            <view class="tag-hot" wx:if="{{item.isHot}}">
              <text class="hot-text">热门</text>
            </view>
          </view>
        </block>
      </view>

      <!-- 加载状态 -->
      <view class="loading-state" wx:if="{{searching}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">搜索中...</text>
      </view>

      <!-- 没有更多 -->
      <view class="no-more" wx:if="{{!hasMore && searchResults.length > 0}}">
        <text class="no-more-text">没有更多结果了</text>
      </view>

      <!-- 空结果 -->
      <view class="empty-results" wx:if="{{!searching && searchResults.length === 0}}">
        <text class="empty-icon">🔍</text>
        <text class="empty-text">没有找到相关结果</text>
        <text class="empty-desc">换个关键词试试吧</text>
      </view>
    </view>

    <!-- 搜索前状态 -->
    <view class="search-before" wx:if="{{!searchValue}}">
      <!-- 搜索历史 -->
      <view class="history-section" wx:if="{{searchHistory.length > 0}}">
        <view class="section-header">
          <text class="section-title">搜索历史</text>
          <view class="clear-history" bind:tap="onClearHistory">
            <text class="clear-text">清除</text>
          </view>
        </view>
        <view class="history-tags">
          <block wx:for="{{searchHistory}}" wx:key="*this">
            <view 
              class="history-tag" 
              data-keyword="{{item}}"
              bind:tap="onHistoryTap"
            >
              <text class="history-text">{{item}}</text>
            </view>
          </block>
        </view>
      </view>

      <!-- 热门搜索 -->
      <view class="hot-section">
        <view class="section-header">
          <text class="section-title">热门搜索</text>
        </view>
        <view class="hot-list">
          <block wx:for="{{hotSearches}}" wx:key="keyword">
            <view 
              class="hot-item" 
              data-keyword="{{item.keyword}}"
              bind:tap="onHotSearchTap"
            >
              <view class="hot-rank">{{index + 1}}</view>
              <text class="hot-keyword">{{item.keyword}}</text>
              <text class="hot-count">{{item.count}} 搜索</text>
            </view>
          </block>
        </view>
      </view>
    </view>
  </view>
</view>