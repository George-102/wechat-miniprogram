<view class="post-detail-page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <custom-nav title="å¸–å­è¯¦æƒ…" show-back="{{true}}" show-back-text="{{true}}">
    <view slot="right" class="nav-actions">
      <view class="nav-btn" bind:tap="onShowShareMenu">
        <text class="btn-icon">â†—ï¸</text>
      </view>
    </view>
  </custom-nav>

  <view class="detail-container" style="padding-top: {{customNavHeight}}px">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- å¸–å­å†…å®¹ -->
    <view class="post-content" wx:if="{{!loading && post}}">
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view class="author-section">
        <view class="author-info">
          <image 
            class="author-avatar" 
            src="{{post.authorAvatar || '/images/default-avatar.png'}}"
            data-user-id="{{post.authorId}}"
            bind:tap="onAvatarTap"
          />
          <view class="author-details">
            <text class="author-name">{{post.authorName}}</text>
            <text class="post-time">{{post.createTime}}</text>
          </view>
        </view>
        <view class="post-tag {{post.tag || 'default'}}">
          {{post.tag || 'åˆ†äº«'}}
        </view>
      </view>

      <!-- å¸–å­å†…å®¹ -->
      <view class="content-section">
        <text class="content-text">{{post.content}}</text>
      </view>

      <!-- å›¾ç‰‡å±•ç¤º -->
      <view class="image-section" wx:if="{{post.images && post.images.length > 0}}">
        <view class="image-grid image-grid-{{post.images.length > 1 ? 'multiple' : 'single'}}">
          <block wx:for="{{post.images}}" wx:key="index">
            <image 
              class="post-image {{post.images.length === 1 ? 'single-image' : ''}}"
              src="{{item}}"
              mode="aspectFill"
            />
          </block>
        </view>
      </view>

      <!-- ä½ç½®ä¿¡æ¯ -->
      <view class="location-section" wx:if="{{post.location}}">
        <view class="location-info">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{post.location}}</text>
        </view>
      </view>

      <!-- äº’åŠ¨ç»Ÿè®¡ -->
      <view class="stats-section">
        <view class="stats-item">
          <text class="stats-number">{{likeCount}}</text>
          <text class="stats-label">ç‚¹èµ</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{post.commentCount || 0}}</text>
          <text class="stats-label">è¯„è®º</text>
        </view>
        <view class="stats-item">
          <text class="stats-number">{{post.viewCount || 0}}</text>
          <text class="stats-label">æµè§ˆ</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-section">
        <view class="action-buttons">
          <view class="action-btn {{liked ? 'active' : ''}}" bind:tap="onLikePost">
            <text class="action-icon">{{liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            <text class="action-text">ç‚¹èµ</text>
          </view>
          <view class="action-btn" bind:tap="onShowCommentInput">
            <text class="action-icon">ğŸ’¬</text>
            <text class="action-text">è¯„è®º</text>
          </view>
          <view class="action-btn {{collected ? 'active' : ''}}" bind:tap="onCollectPost">
            <text class="action-icon">{{collected ? 'â­' : 'â˜†'}}</text>
            <text class="action-text">æ”¶è—</text>
          </view>
          <view class="action-btn" bind:tap="onShowShareMenu">
            <text class="action-icon">â†—ï¸</text>
            <text class="action-text">åˆ†äº«</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-section" wx:if="{{!loading}}">
      <comment-list 
        comments="{{comments}}"
        postId="{{postId}}"
        bind:reply="onReplyComment"
        bind:likeComment="onLikeComment"
        bind:avatarTap="onAvatarTap"
      />

      <!-- è¯„è®ºåŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{commentLoading && comments.length > 0}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤šè¯„è®º -->
      <view class="no-more" wx:if="{{!hasMore && comments.length > 0}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šè¯„è®ºäº†</text>
      </view>

      <!-- ç©ºè¯„è®º -->
      <view class="empty-comments" wx:if="{{!commentLoading && comments.length === 0}}">
        <text class="empty-icon">ğŸ’¬</text>
        <text class="empty-text">æš‚æ— è¯„è®º</text>
        <text class="empty-desc">å¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§</text>
      </view>
    </view>
  </view>

  <!-- è¯„è®ºè¾“å…¥æ¡† -->
  <view class="comment-input-section {{showCommentInput ? 'show' : ''}}">
    <view class="comment-input-container">
      <view class="input-header" wx:if="{{replyingTo}}">
        <text class="reply-text">å›å¤ @{{replyingTo.authorName}}</text>
        <view class="cancel-reply" bind:tap="onShowCommentInput">
          <text class="cancel-text">å–æ¶ˆå›å¤</text>
        </view>
      </view>
      <view class="input-content">
        <textarea 
          class="comment-textarea" 
          placeholder="{{replyingTo ? 'å›å¤ ' + replyingTo.authorName : 'è¯´ç‚¹ä»€ä¹ˆ...'}}"
          value="{{commentText}}"
          bindinput="onCommentInput"
          maxlength="500"
          show-confirm-bar="{{false}}"
          auto-focus
        />
        <view 
          class="submit-btn {{commentText.trim() ? 'active' : ''}}"
          bind:tap="onSubmitComment"
        >
          <text class="submit-text">å‘é€</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions" wx:if="{{!showCommentInput}}">
    <view class="action-input" bind:tap="onShowCommentInput">
      <text class="input-placeholder">è¯´ç‚¹ä»€ä¹ˆ...</text>
    </view>
    <view class="action-buttons">
      <view class="action-btn {{liked ? 'active' : ''}}" bind:tap="onLikePost">
        <text class="action-icon">{{liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="action-count">{{likeCount}}</text>
      </view>
      <view class="action-btn" bind:tap="onShowCommentInput">
        <text class="action-icon">ğŸ’¬</text>
        <text class="action-count">{{post ? post.commentCount : 0}}</text>
      </view>
      <view class="action-btn {{collected ? 'active' : ''}}" bind:tap="onCollectPost">
        <text class="action-icon">{{collected ? 'â­' : 'â˜†'}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«èœå• -->
  <view class="share-menu {{shareMenu ? 'show' : ''}}">
    <view class="menu-mask" bind:tap="onHideShareMenu"></view>
    <view class="menu-content">
      <view class="menu-header">
        <text class="menu-title">åˆ†äº«åˆ°</text>
      </view>
      <view class="menu-options">
        <view class="menu-option" bind:tap="onSharePost">
          <view class="option-icon">ğŸ‘¥</view>
          <text class="option-text">å¾®ä¿¡å¥½å‹</text>
        </view>
        <view class="menu-option" bind:tap="onCopyLink">
          <view class="option-icon">ğŸ”—</view>
          <text class="option-text">å¤åˆ¶é“¾æ¥</text>
        </view>
        <view class="menu-option" bind:tap="onReportPost">
          <view class="option-icon">ğŸš«</view>
          <text class="option-text">ä¸¾æŠ¥</text>
        </view>
      </view>
      <view class="menu-cancel" bind:tap="onHideShareMenu">
        <text class="cancel-text">å–æ¶ˆ</text>
      </view>
    </view>
  </view>
</view>